<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tìm Kiếm & Thay Thế Chương</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
  <style>
    .hl-yellow { background: #ffff99; color: black; }
    .hl-pink   { background: #ffcccc; color: black; }
    .hl-blue   { background: #99ccff; color: black; }
    .hl-green  { background: #ccffcc; color: black; }
    .hl-orange { background: #ffcc99; color: black; }
    .hl-purple { background: #e6ccff; color: black; }

    /* Overlay login/register */
    #login-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.5);
      display: flex; justify-content:center; align-items:center;
      z-index: 50;
    }
    #login-box {
      background: white; padding: 2rem; border-radius: 0.5rem; width: 300px;
    }
    #login-box input { width: 100%; margin-bottom: 0.5rem; padding: 0.4rem; border:1px solid #ccc; border-radius: 0.25rem; }
    #login-box button { width: 100%; padding: 0.5rem; margin-top: 0.5rem; border:none; border-radius:0.25rem; background:#3b82f6; color:white; cursor:pointer; }
    #login-box .toggle-btn { background:#6b7280; margin-top:0.3rem; }
    #login-box #login-error { color:red; font-size: 0.8rem; margin-top:0.3rem; }
  </style>
</head>
<body class="bg-gray-100 h-screen flex">

  <!-- Login/Register Overlay -->
  <div id="login-overlay">
    <div id="login-box">
      <h2 id="login-title" class="text-lg font-bold mb-2">Đăng Nhập</h2>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Mật khẩu">
      <input type="password" id="confirm-password" placeholder="Xác nhận mật khẩu" style="display:none">
      <button id="login-btn">Đăng Nhập</button>
      <button id="switch-btn" class="toggle-btn">Đăng ký tài khoản mới</button>
      <div id="login-error"></div>
    </div>
  </div>

  <!-- Left Panel -->
  <div id="main-panel" class="w-1/5 p-4 bg-white shadow-md overflow-y-auto text-sm hidden">
    <h2 class="text-xl font-bold mb-4">Tìm Kiếm</h2>
    <div class="mb-4">
      <label class="block mb-2">Font:</label>
      <select id="fontFamily" class="w-full p-2 border rounded text-sm">
        <option value="Arial">Arial</option>
        <option value="Calibri">Calibri</option>
        <option value="Montserrat">Montserrat</option>
        <option value="Times New Roman">Times New Roman</option>
      </select>
    </div>
    <div class="mb-4">
      <label class="block mb-2">Cỡ chữ:</label>
      <select id="fontSize" class="w-full p-2 border rounded text-sm">
        <option value="14px">14px</option>
        <option value="16px">16px</option>
        <option value="18px">18px</option>
        <option value="20px">20px</option>
      </select>
    </div>
    <div class="mb-4 space-y-2">
      <label><input type="checkbox" id="matchCase" class="mr-2"> Phân biệt hoa/thường</label>
      <label><input type="checkbox" id="wholeWords" class="mr-2"> Từ hoàn chỉnh</label>
    </div>
    <div class="mb-4">
      <label class="block mb-2">Từ khóa:</label>
      <input type="text" id="keywords-input" placeholder="Nhập, Enter..." class="w-full p-2 border rounded bg-gray-50 text-sm">
      <div id="keywords-tags" class="flex flex-wrap gap-1 mt-2"></div>
    </div>
    <div class="flex gap-2">
      <button id="search" class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600 text-xs font-medium">Tìm Kiếm</button>
      <button id="clear" class="flex-1 bg-red-500 text-white py-2 rounded hover:bg-red-600 text-xs font-medium">Xóa Tất Cả</button>
    </div>
  </div>

  <!-- Center Panel -->
  <div id="text-panel" class="w-3/5 p-6 bg-white shadow-md mx-4 flex flex-col hidden">
    <div class="flex justify-between items-start mb-2">
      <h2 class="text-xl font-bold">Nội Dung Chương</h2>
      <div class="text-right text-xs text-red-600 font-semibold leading-tight">
        <div>Don@te cho ad: MB BANK - TRINH THI XUAN HUONG - STK: 0917678211</div>
        <div>Góp ý: <a href="https://www.facebook.com/trinh.hg.57" target="_blank" class="text-blue-600 underline hover:text-blue-800">https://www.facebook.com/trinh.hg.57</a></div>
      </div>
    </div>
    <div id="textInput"
         contenteditable="true"
         class="flex-1 p-6 border-2 border-gray-300 rounded-lg focus:outline-none whitespace-pre-wrap overflow-y-auto"
         style="min-height: 70vh; font-family: Arial; font-size: 16px; line-height: 1.8;">
    </div>
  </div>

  <!-- Right Panel -->
  <div id="settings-panel" class="w-1/5 p-4 bg-white shadow-md overflow-y-auto text-xs hidden">
    <h2 class="text-xl font-bold mb-4">Thay Thế</h2>

    <div class="mode-controls mb-3 space-y-1">
      <div class="flex gap-1">
        <select id="mode-select" class="flex-1 p-1 border rounded text-xs"></select>
        <button id="add-mode" class="px-1 py-0.5 bg-blue-500 text-white rounded text-xs">Thêm</button>
      </div>
      <div class="flex gap-1">
        <button id="copy-mode" class="flex-1 px-1 py-0.5 bg-blue-500 text-white rounded text-xs">Sao</button>
        <button id="match-case" class="flex-1 px-1 py-0.5 bg-gray-500 text-white rounded text-xs">Case</button>
      </div>
      <div class="flex gap-1">
        <button id="export-settings" class="flex-1 px-1 py-0.5 bg-blue-500 text-white rounded text-xs">Xuất</button>
        <button id="import-settings" class="flex-1 px-1 py-0.5 bg-blue-500 text-white rounded text-xs">Nhập</button>
      </div>
      <div class="flex gap-1">
        <button id="rename-mode" class="flex-1 px-1 py-0.5 bg-gray-500 text-white rounded text-xs hidden">Đổi tên</button>
        <button id="delete-mode" class="flex-1 px-1 py-0.5 bg-red-500 text-white rounded text-xs hidden">Xóa</button>
      </div>
    </div>

    <div class="action-buttons mb-3 flex gap-1">
      <button id="add-pair" class="flex-1 px-2 py-1 bg-blue-500 text-white rounded text-xs">Cặp</button>
      <button id="save-settings" class="flex-1 px-2 py-1 bg-green-600 text-white rounded text-xs">Lưu</button>
      <button id="replace-all" class="flex-1 px-2 py-1 bg-purple-600 text-white rounded text-xs">Thay</button>
    </div>

    <div id="punctuation-list" class="space-y-2 text-xs"></div>
  </div>

  <div id="notification-container"></div>

  <!-- Nhost JS UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@nhost/nhost-js@latest/umd/nhost-js.umd.js"></script>

  <script src="index.js"></script>
  <script>
    // Khởi tạo Nhost client
    const nhost = new window.Nhost.NhostClient({
      subdomain: 'ogltettlkspwxyqphmth',
      region: 'eu-central-1'
    });

    // Login/Register logic
    const loginOverlay = document.getElementById('login-overlay');
    const loginBtn = document.getElementById('login-btn');
    const switchBtn = document.getElementById('switch-btn');
    const loginTitle = document.getElementById('login-title');
    const loginError = document.getElementById('login-error');
    const confirmPassword = document.getElementById('confirm-password');

    let isRegister = false;

    switchBtn.onclick = () => {
      isRegister = !isRegister;
      loginTitle.textContent = isRegister ? 'Đăng Ký' : 'Đăng Nhập';
      loginBtn.textContent = isRegister ? 'Đăng Ký' : 'Đăng Nhập';
      confirmPassword.style.display = isRegister ? 'block' : 'none';
      switchBtn.textContent = isRegister ? 'Đăng Nhập' : 'Đăng ký tài khoản mới';
      loginError.textContent = '';
    };

    loginBtn.onclick = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        if (isRegister) {
          const confirm = confirmPassword.value;
          if (password !== confirm) {
            loginError.textContent = 'Mật khẩu không khớp!';
            return;
          }
          const { user, error } = await nhost.auth.signUp({ email, password });
          if (error) { loginError.textContent = error.message; return; }
          loginError.textContent = 'Đăng ký thành công! Vui lòng đăng nhập.';
          switchBtn.click();
        } else {
          const { session, error } = await nhost.auth.signIn({ email, password });
          if (error) { loginError.textContent = error.message; return; }
          loginOverlay.style.display = 'none';
          document.getElementById('main-panel').style.display = 'block';
          document.getElementById('text-panel').style.display = 'block';
          document.getElementById('settings-panel').style.display = 'block';
        }
      } catch (err) {
        console.error(err);
        loginError.textContent = 'Lỗi không xác định!';
      }
    };
  </script>
</body>
</html>
